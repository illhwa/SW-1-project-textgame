import random
import time
import string

class Player:
    def __init__(self, name):
        self.name = name
        self.health = 100
        self.attack = 20
        self.defense = 10
        self.coins = 0
        self.items = []
        self.companion = None

    def show_stats(self):
        print("\nğŸ“œ [í”Œë ˆì´ì–´ ëŠ¥ë ¥ì¹˜]")
        print(f"â¤ï¸ ì²´ë ¥: {self.health}")
        print(f"âš”ï¸ ê³µê²©ë ¥: {self.attack}")
        print(f"ğŸ›¡ï¸ ë°©ì–´ë ¥: {self.defense}")
        print(f"ğŸ’° ì¬í™”: {self.coins}ì›")
        print(f"ğŸ’ ë³´ìœ  ì•„ì´í…œ: {self.items if self.items else 'ì—†ìŒ'}\n")
        if self.companion:
            print(f"ğŸ§‘â€ğŸ¤â€ğŸ§‘ ë™ë£Œ: {self.companion['name']} (ê³µê²©ë ¥ +{self.companion['attack']})")
        print()

    def attack_monster(self, monster):
        damage = self.attack
        monster.health -= damage
        print(f"âš”ï¸ í”Œë ˆì´ì–´ì˜ ê³µê²©! ëª¬ìŠ¤í„°ì—ê²Œ {damage}ë§Œí¼ ë°ë¯¸ì§€ ì£¼ì—ˆìŒ. ëª¬ìŠ¤í„° ì²´ë ¥: {monster.health}")

    def heal(self):
        self.health = 100
        print("ğŸ€ ì²´ë ¥ì´ ê°€ë“ ì°¨ì„œ ì™„ì „íˆ íšŒë³µí–ˆìŠµë‹ˆë‹¤!")

    def buy_item(self, item):
        self.items.append(item)
        print(f"ğŸ›ï¸ {item}ì„(ë¥¼) êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤!")

    def lose_stats_on_death(self):
        self.attack = max(5, self.attack - 5)
        self.defense = max(5, self.defense - 3)
        print("âš ï¸ ëŠ¥ë ¥ì¹˜ê°€ ì¼ë¶€ ê°ì†Œí–ˆìŠµë‹ˆë‹¤! ê³µê²©ë ¥ê³¼ ë°©ì–´ë ¥ì´ ì¤„ì–´ë“¤ì—ˆìŠµë‹ˆë‹¤.")

class Monster:
    def __init__(self, name, health, attack, grade):
        self.name = name
        self.health = health
        self.attack = attack
        self.grade = grade
        self.coins = self.calculate_coins()

    def calculate_coins(self):
        if self.grade == "ì¼ë°˜":
            return random.randint(1, 3)
        elif self.grade == "ë ˆì–´":
            return random.randint(4, 7)
        else:  # ë³´ìŠ¤
            return random.randint(8, 15)

    def show_stats(self):
        print(f"ğŸ‘¹ ëª¬ìŠ¤í„° ì´ë¦„: {self.name}")
        print(f"ë“±ê¸‰: {self.grade}")
        print(f"â¤ï¸ ì²´ë ¥: {self.health}")
        print(f"âš”ï¸ ê³µê²©ë ¥: {self.attack}")
        print(f"ğŸ’° ì£¼ëŠ” ì¬í™”: {self.coins}ì›")

    def attack_player(self, player):
        damage = self.attack
        player.health -= damage
        print(f"ğŸ’¥ ëª¬ìŠ¤í„°ì˜ ê³µê²©! {damage}ë§Œí¼ ë°ë¯¸ì§€ ë°›ìŒ. ì²´ë ¥: {player.health}")

# ğŸ² í™€ì§ ê²Œì„
def dice_game():
    print("ğŸ² í™€ì§ ê²Œì„! (ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°)")
    guess = input("í™€(h) ë˜ëŠ” ì§(e) ì„ íƒ: ").lower()
    roll = random.randint(1, 6)
    print(f"ğŸ² ì£¼ì‚¬ìœ„ ê²°ê³¼: {roll}")
    return (roll % 2 == 0 and guess == 'e') or (roll % 2 == 1 and guess == 'h')

# âœŠâœ‹âœŒï¸ ê°€ìœ„ë°”ìœ„ë³´ ê²Œì„
def rock_paper_scissors():
    print("âœŠâœ‹âœŒï¸ ê°€ìœ„ë°”ìœ„ë³´ ê²Œì„!")
    choices = ["ê°€ìœ„", "ë°”ìœ„", "ë³´"]

    while True:
      player_choice = input("ê°€ìœ„, ë°”ìœ„, ë³´ ì¤‘ ì„ íƒ: ")
      monster_choice = random.choice(choices)
      print(f"ğŸ‘¹ ëª¬ìŠ¤í„°: {monster_choice}")

      if player_choice == monster_choice:
          print("âš–ï¸ ë¬´ìŠ¹ë¶€! ë‹¤ì‹œ ë„ì „!")
          return rock_paper_scissors()
      elif (player_choice == "ê°€ìœ„" and monster_choice == "ë³´") or \
           (player_choice == "ë°”ìœ„" and monster_choice == "ê°€ìœ„") or \
           (player_choice == "ë³´" and monster_choice == "ë°”ìœ„"):
          return True
      else:
          return False

# â±ï¸ íƒ€ì´ë° ë§ì¶”ê¸° ê²Œì„
def timing_game():
    print("â±ï¸ íƒ€ì´ë° ë§ì¶”ê¸° ê²Œì„!")
    print("ì§€ê¸ˆ íƒ€ì´ë°ì„ ë§ì¶°ì„œ Enterë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”!")
    time.sleep(random.uniform(1, 3))  # 1~3ì´ˆ ì‚¬ì´ì— íƒ€ì´ë°ì„ ë§ì¶°ì•¼ í•¨
    start = time.time()
    input("ëˆ„ë¥´ë©´ íƒ€ì´ë°ì´ ì‹œì‘ë©ë‹ˆë‹¤! (Enter í‚¤) ")
    reaction_time = time.time() - start

    print(f"ë°˜ì‘ ì‹œê°„: {reaction_time:.3f}ì´ˆ")
    return reaction_time < 2  # 2ì´ˆ ì´ë‚´ì— ë§ì¶”ë©´ ì„±ê³µ


# ğŸ¹ ì „íˆ¬ ì‹œìŠ¤í…œ (ì—…ë°ì´íŠ¸ëœ ë¯¸ë‹ˆê²Œì„ í¬í•¨)
def battle(player, monster):
    print("\nâš”ï¸ ëª¬ìŠ¤í„°ì™€ì˜ ì „íˆ¬ ì‹œì‘!")

    mini_games = [
        dice_game, rock_paper_scissors, timing_game
    ]

    while monster.health > 0:
        print("\nğŸ”¥ ë¯¸ë‹ˆê²Œì„ ë„ì „!")
        game = random.choice(mini_games)

        if game():  # ë¯¸ë‹ˆê²Œì„ì—ì„œ ìŠ¹ë¦¬ ì‹œ
            print("ğŸ‰ ìŠ¹ë¦¬! ëª¬ìŠ¤í„°ì—ê²Œ ê³µê²© ì„±ê³µ!")
            player.attack_monster(monster)
        else:  # ë¯¸ë‹ˆê²Œì„ì—ì„œ íŒ¨ë°° ì‹œ
            print("ğŸ’¥ íŒ¨ë°°! ëª¬ìŠ¤í„°ì˜ ê³µê²©!")
            monster.attack_player(player)

        if player.health <= 0:
            print("ğŸ’€ í”Œë ˆì´ì–´ê°€ ì‚¬ë§í–ˆìŠµë‹ˆë‹¤...")
            player.lose_stats_on_death()
            return False  # ê²Œì„ ì¢…ë£Œ

    print(f"ğŸŠ ëª¬ìŠ¤í„° ì²˜ì¹˜ ì™„ë£Œ! +{monster.coins} ì¬í™” íšë“!")
    player.coins += monster.coins

    # ì „íˆ¬ ëë‚œ í›„ ì—”í„°ë¥¼ ëˆ„ë¥¼ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
    input("ì „íˆ¬ê°€ ëë‚¬ìŠµë‹ˆë‹¤. ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°€ë ¤ë©´ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”...")

    return True  # ëª¬ìŠ¤í„° ì²˜ì¹˜ í›„ ì „íˆ¬ ì¢…ë£Œ

# ğŸ° ë˜ì „ íƒí—˜
def dungeon(player):
    while player.health > 0:
        print("\nğŸ” ë˜ì „ íƒí—˜ ì¤‘...")
        # ë˜ì „ì—ì„œ ë§Œë‚  ìˆ˜ ìˆëŠ” ìƒí™©ë“¤
        event = random.choices(["monster", "shop", "rest", "trap", "companion"], [0.4, 0.2, 0.2, 0.1, 0.1])[0]

        if event == "monster":
            monster_name = random.choice(["ì•…ëª½ì˜ ê´´ë¬¼", "ì§€ì˜¥ì˜ ì‚¬ì", "êµ¬ë¦„ì˜ ë§ˆì™•", "ë¶ˆì‚¬ì˜ ê´´ë¬¼", "ì–´ë‘ ì˜ ì§€ë°°ì"])
            grade = random.choices(["ì¼ë°˜", "ë ˆì–´", "ë³´ìŠ¤"], [0.5, 0.3, 0.2])[0]
            if grade == "ì¼ë°˜":
                monster = Monster(monster_name, health=30, attack=5, grade="ì¼ë°˜")
            elif grade == "ë ˆì–´":
                monster = Monster(monster_name, health=50, attack=10, grade="ë ˆì–´")
            else:  # ë³´ìŠ¤
                monster = Monster(monster_name, health=100, attack=20, grade="ë³´ìŠ¤")

            monster.show_stats()
            if not battle(player, monster):
                restart = input("ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n): ").lower()
                if restart == "y":
                    player.health = 100
                    continue
                else:
                    break
        elif event == "shop":
            print("\nğŸ›’ ìƒì ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!")
            shop_items = [ "ë¹µ", "í–„ë²„ê±°", "ë¶ˆêµ´ì˜ ë°©íŒ¨", "ê°•í™”ëœ ë§ˆê²€"]
            print("ìƒì  ì•„ì´í…œ:", shop_items)
            item_choice = input("ì•„ì´í…œì„ êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n): ").lower()
            if item_choice == "y":
                print("ì–´ë–¤ê±¸ êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")
                item_buy = input("")
            if item_buy == "ë¹µ":
                print("ì˜ êµ¬ì›Œì§„ ë¹µ ë¨¹ìœ¼ë©´ í¬ë§Œê°(10)ê³¼ ì²´ë ¥(5)ì´(ê°€) ì˜¬ë¼ê°„ë‹¤. ê°€ê²©ì€ 5ê³¨ë“œ")
                item_result = input("êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë„¤(Y)/ì•„ë‹ˆìš”(N)")
                if item_result == "ë„¤" or item_result == "Y":
                    print("ë¹µì„ êµ¬ë§¤í•˜ì˜€ë‹¤!")
                    player.buy_item("ë¹µ")
                else:
                    continue

            if item_buy == "í–„ë²„ê±°":
                print("ë§›ìˆëŠ” í–„ë²„ê±°ë‹¤! ì™ ì§€ ëª¨ë¥´ê² ì§€ë§Œ ì„ ë¬¸ëŒ€ë³¸ê´€ì  ë‰´ìš•ë²„ê±°ë¼ ì¨ìˆë‹¤. í¬ë§Œê°(30)ê³¼ ì²´ë ¥(15)ì´(ê°€) ì˜¬ë¼ê°„ë‹¤. ê°€ê²©ì€ 15ê³¨ë“œ")
                item_result = input("êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë„¤(Y)/ì•„ë‹ˆìš”(N)")
                if item_result == "ë„¤" or item_result == "Y":
                    print("í–„ë²„ê±°ë¥¼ êµ¬ë§¤í•˜ì˜€ë‹¤!")
                    player.buy_item("í–„ë²„ê±°")
                else:
                    continue

            if item_buy == "ë¶ˆêµ´ì˜ ë°©íŒ¨":
                print("ë­”ê°€ ì—„ì²­ ê°•ë ¥í•´ë³´ì´ëŠ” ë°©íŒ¨. ë­ë“  ë‹¤ ë§‰ì„ ìˆ˜ ìˆì„ê±° ê°™ë‹¤. ì²´ë ¥ì´(5)ì˜¬ë¼ê°€ê³  ë°©ì–´ë ¥ì´(30)ì˜¬ë¼ê°„ë‹¤. ê°€ê²©ì€ 100ê³¨ë“œ")
                item_result = input("êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë„¤(Y)/ì•„ë‹ˆìš”(N)")
                if item_result == "ë„¤" or item_result == "Y":
                    print("ë¶ˆêµ´ì˜ ë°©íŒ¨ë¥¼ êµ¬ë§¤í•˜ì˜€ë‹¤!")
                    player.coins -= 100
                    player.defense += 30
                    player.health += 5
                    player.buy_item("ë¶ˆêµ´ì˜ ë°©íŒ¨")
                else:
                    continue

            if item_buy == "ê°•í™”ëœ ë§ˆê²€":
                print("ê·€ì² ë¡œ ë§Œë“  ë§ˆê²€, ì´ê²ƒë§Œ ìˆìœ¼ë©´ ëª¨ë“  ëª¬ìŠ¤í„°ëŠ” ì›í„´í‚¬ í•  ìˆ˜ ìˆì„ê±° ê°™ë‹¤. ê³µê²©ë ¥ì´(20)ì˜¬ë¼ê°€ì§€ë§Œ í˜„ì¬ ì²´ë ¥ì´(50)ê°ì†Œí•œë‹¤. ê°€ê²©ì€ 300ê³¨ë“œ")
                item_result = input("êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë„¤(Y)/ì•„ë‹ˆì˜¤(N)")
                if item_result == "ë„¤" or item_result == "Y":
                    print("ê°•í™”ëœ ë§ˆê²€ì„ êµ¬ë§¤í•˜ì˜€ë‹¤!")
                    player.coins -= 300
                    player.attack += 20
                    player.health -= 50
                    player.buy_item("ê°•í™”ëœ ë§ˆê²€")
                else:
                    continue

                item = random.choice(shop_items)
                player.buy_item(item)

        elif event == "rest":
            print("\nğŸ›Œ ì‰¼í„° ë°œê²¬! ì²´ë ¥ì„ íšŒë³µí•©ë‹ˆë‹¤.")
            player.heal()

        elif event == "trap":
            print("\nâš ï¸ í•¨ì •ì— ë¹ ì¡ŒìŠµë‹ˆë‹¤! ì²´ë ¥ì´ ë°˜ìœ¼ë¡œ ì¤„ì–´ë“­ë‹ˆë‹¤.")
            player.health //= 2

        elif event == "ë™ë£Œ" and player.companion is None:
            companions = ["ì „ì‚¬", "ë§ˆë²•ì‚¬", "ëŠ‘ëŒ€"]
            new_companion = random.choice(companions)
            choice = input(f"{new_companion}ë¥¼ ë™ë£Œë¡œ ë°›ì•„ë“¤ì´ì‹œê² ìŠµë‹ˆê¹Œ? (ì˜ˆ/ì•„ë‹ˆì˜¤) ").lower()
            if choice == "ì˜ˆ":
                print(f"{new_companion}ê°€ ë‹¹ì‹ ì˜ ë™ë£Œê°€ ë˜ì—ˆìŠµë‹ˆë‹¤!")
                player.companion = new_companion
            else:
                print(f"{new_companion}ë¥¼ ê±°ì ˆí–ˆìŠµë‹ˆë‹¤. ê·¸/ê·¸ë…€/ê·¸ê²ƒ(ì´)ê°€ ë‹¹ì‹ ì„ ê¸°ì–µí•  ê²ƒì…ë‹ˆë‹¤.")

        player.show_stats()

# ë©”ì¸ í•¨ìˆ˜
def main():
    name = input("ğŸ® ë˜ì „ íƒí—˜ ê²Œì„ì— ì˜¤ì‹  ê±¸ í™˜ì˜í•©ë‹ˆë‹¤! ìºë¦­í„°ì˜ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”: ")
    player = Player(name)
    dungeon(player)

if __name__ == "__main__":
    main()
